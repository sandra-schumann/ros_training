

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Service Server &amp; Service Client &mdash; ROS Training For Industry 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/hacks.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tracking AR tags with USB camera" href="ar_tracker.html" />
    <link rel="prev" title="Launch file" href="launch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ROS Training For Industry
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/system_setup.html">System Setup</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day1/index.html">Day 1</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Day 2</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="catkin_workspace.html">Create Catkin Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="catkin_package.html">Creating Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="node.html">Creating Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="messages.html">Publisher &amp; Subscriber</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Using parameters in your node</a></li>
<li class="toctree-l2"><a class="reference internal" href="launch.html">Launch file</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Service Server &amp; Service Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bonus-task">Bonus task</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ar_tracker.html">Tracking AR tags with USB camera</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day3/index.html">Day 3</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day4/index.html">Day 4</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day5/index.html">Day 5</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROS Training For Industry</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Day 2</a> &raquo;</li>
        
      <li>Service Server &amp; Service Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/day2/services.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="service-server-service-client">
<h1>Service Server &amp; Service Client<a class="headerlink" href="#service-server-service-client" title="Permalink to this headline">¶</a></h1>
<p>The first type of ROS communication that we explored was a one-way interaction called messages which are sent over channels called topics. Now we are going to explore a different communication type, which is a two-way interaction via a request from one node to another and a response from that node to the first.</p>
<dl class="docutils">
<dt>After completing this exercise, you will have the answers to the following questions:</dt>
<dd><ul class="first last simple">
<li>How to create a custom messages/services?</li>
<li>Wow to use <code class="docutils literal notranslate"><span class="pre">message_genetation</span></code>?</li>
<li>How to implement a simple service server?</li>
</ul>
</dd>
</dl>
<ol class="arabic">
<li><p class="first">First, read through the ROS tutorials section on <a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/CreatingMsgAndSrvhow">Creating a ROS msg and srv</a>.</p>
</li>
<li><p class="first">Next, navigate to the root of your <code class="docutils literal notranslate"><span class="pre">fake_sonar_driver</span></code> package and create a subdirectory named <code class="docutils literal notranslate"><span class="pre">srv</span></code> for our custom service. Our service will enable changing the sonar’s field of view (FOV), which is published as part of the <code class="docutils literal notranslate"><span class="pre">Range</span></code> message.</p>
</li>
<li><p class="first">In the <code class="docutils literal notranslate"><span class="pre">srv</span></code> directory, create a service file named <code class="docutils literal notranslate"><span class="pre">SetSonarFOV.srv</span></code> with the following request and response parts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span class="c1"># Sets .</span>
<span class="n">float64</span> <span class="n">fov_to_set</span>
<span class="o">---</span>
<span class="n">float64</span> <span class="n">set_fov</span>
</pre></div>
</div>
</li>
<li><p class="first">Make changes in your <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> to include <code class="docutils literal notranslate"><span class="pre">message_generation</span></code> for this service.</p>
</li>
<li><p class="first">Test it out:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre>rossrv show fake_sonar_driver SetSonarFOV
</pre></div>
</div>
</li>
<li><p class="first">Good Job! It’s now time to learn the steps needed to create a service server (waits for request and comes up with response) and client (makes request for info then waits for response).</p>
</li>
<li><p class="first">Complete the <a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/WritingServiceClient%28c%2B%2B%29">Writing a Simple Service and Client (C++)</a> tutorial.</p>
</li>
<li><p class="first">Now that you know how service server and client are implemented in nodes, let’s add a service server to <code class="docutils literal notranslate"><span class="pre">fake_sonar_driver_node</span></code>.</p>
</li>
<li><p class="first">Add the following functionality to our fake sonar node:</p>
<ul class="simple">
<li>the node advertises a service on topic <code class="docutils literal notranslate"><span class="pre">/set_sonar_fov</span></code></li>
<li>the service type is <code class="docutils literal notranslate"><span class="pre">fake_sonar_driver/SetSonarFOV</span></code></li>
<li>the server will check <code class="docutils literal notranslate"><span class="pre">fov_to_set</span></code> field and responds back with the same value in <code class="docutils literal notranslate"><span class="pre">set_fov</span></code> field.</li>
</ul>
</li>
<li><p class="first">Test the server with <code class="code docutils literal notranslate"><span class="pre">rossrv</span> <span class="pre">call</span> <span class="pre">/sonar_distance</span> <span class="pre">1.4</span></code> and show the result to the instructor.</p>
</li>
<li><p class="first">Improve the <code class="docutils literal notranslate"><span class="pre">fake_sonar_driver_node</span></code> such that the <code class="docutils literal notranslate"><span class="pre">fov_to_set</span></code> value would be updated into the <code class="docutils literal notranslate"><span class="pre">/sonar_distance</span></code> topic. The easies way to do this is by defining <code class="docutils literal notranslate"><span class="pre">field_of_view</span></code> as a global variable:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;...&gt;</span><span class="cp"></span>

<span class="kt">double</span> <span class="n">field_of_view</span><span class="p">;</span>

<span class="kt">bool</span> <span class="nf">callback_function_for_server</span><span class="p">(...)</span>
<span class="p">{</span>
  <span class="c1">// set field_of_view here</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(...)</span>
<span class="p">{</span>
  <span class="c1">// use field_of_view here</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Would it be awesome to visualize the sonar range and its field of view graphically? In ROS, this is peace of cake:</p>
<ul class="simple">
<li>Open a new terminal and type: <code class="code docutils literal notranslate"><span class="pre">rviz</span></code></li>
<li>In RViz, click the <code class="docutils literal notranslate"><span class="pre">add</span></code> button on the Displays panel (the one on the left side).</li>
<li>Select the <code class="docutils literal notranslate"><span class="pre">By</span> <span class="pre">topic</span></code> tab and double-click on the <code class="docutils literal notranslate"><span class="pre">/sonar_distance</span></code> topic.</li>
</ul>
</li>
<li><p class="first">Open another terminal and change the field of view with the <code class="code docutils literal notranslate"><span class="pre">rossrv</span> <span class="pre">call</span></code> command. See if you notice any changes in RViz.</p>
</li>
<li><p class="first">Present your solution to the instructor. Congratulations, you are now ready to face the challenges in day 3!</p>
</li>
</ol>
<div class="section" id="bonus-task">
<h2>Bonus task<a class="headerlink" href="#bonus-task" title="Permalink to this headline">¶</a></h2>
<p>Currently our fake sonar node has publishers and subscribers laying next to main(). However, to make our code modular, we should restructure it and place the publisher, service server, and callback functions into a separate <code class="docutils literal notranslate"><span class="pre">FakeSonarDriver</span></code> class.</p>
<ol class="arabic simple">
<li>Create the <code class="docutils literal notranslate"><span class="pre">src/fake_sonar_driver.cpp</span></code> and <code class="docutils literal notranslate"><span class="pre">include/fake_sonar_driver/fake_sonar_driver.h</span></code> files.</li>
<li>Replace the existing while loop with a <a class="reference external" href="http://wiki.ros.org/roscpp/Overview/Timers">timer</a> that would update the sine() value in the class.</li>
<li>The <code class="code docutils literal notranslate"><span class="pre">main()</span></code> function should now simply create the <code class="docutils literal notranslate"><span class="pre">FakeSonarDriver</span></code> object and spin forever using <code class="docutils literal notranslate"><span class="pre">ros::spin()</span></code>.</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ar_tracker.html" class="btn btn-neutral float-right" title="Tracking AR tags with USB camera" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="launch.html" class="btn btn-neutral float-left" title="Launch file" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, University of Tartu, License CC BY-ND-NC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>