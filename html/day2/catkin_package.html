

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; ROS Training For Industry 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/hacks.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ROS Training For Industry
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../template/template.html">Training Style Templates</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/system_setup.html">System Setup</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day1/index.html">Day 1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Day 2</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day3/index.html">Day 3</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day4/index.html">Day 4</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day5/index.html">Day 5</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROS Training For Industry</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/day2/catkin_package.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># Creating Packages and Nodes
&gt;In this exercise, we will create our own ROS package and node.</p>
<p>## Motivation
The basis of ROS communication is that multiple executables called nodes are running in an environment and communicating with each other in various ways. These nodes exist within a structure called a package. In this module we will create a node inside a newly created package.</p>
<p>## Reference Example
[Create a Package](<a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/CreatingPackage">http://wiki.ros.org/ROS/Tutorials/CreatingPackage</a>)</p>
<p>## Further Information and Resources
[Building Packages](<a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/BuildingPackages">http://wiki.ros.org/ROS/Tutorials/BuildingPackages</a>)</p>
<p>[Understanding Nodes](<a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/UnderstandingNodes">http://wiki.ros.org/ROS/Tutorials/UnderstandingNodes</a>)</p>
<p>## Scan-N-Plan Application: Problem Statement
We’ve installed ROS, created a workspace, and even built a few times. Now we want to create our own package and our own node to do what we want to do.</p>
<p>Your goal is to create your first ROS node:</p>
<blockquote>
<div><ol class="arabic simple">
<li>First you need to create a package inside your catkin workspace.</li>
<li>Then you can write your own node</li>
</ol>
</div></blockquote>
<p>## Scan-N-Plan Application: Guidance</p>
<p>### Create a Package
1. cd into the catkin workspace src directory</p>
<blockquote>
<div><p>_Note: Remember that all packages should be created inside a workspace src directory._</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">~/catkin_ws/src</span>
<span class="pre">`</span></code></p>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Use the ROS command to create a package called _myworkcell_core_ with a dependency on _roscpp_</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">catkin</span> <span class="pre">create</span> <span class="pre">pkg</span> <span class="pre">myworkcell_core</span> <span class="pre">--catkin-deps</span> <span class="pre">roscpp</span>
<span class="pre">`</span></code></p>
<p>See the [catkin_tools](<a class="reference external" href="https://catkin-tools.readthedocs.io/en/latest/verbs/catkin_create.html">https://catkin-tools.readthedocs.io/en/latest/verbs/catkin_create.html</a>) documentation for more details on this command.</p>
<ul class="simple">
<li>_This command creates a directory and required files for a new ROS package._</li>
<li>_The first argument is the name of the new ROS package._</li>
<li>_Use <cite>–catkin-deps</cite> to specify packages which the newly created package depends on._</li>
</ul>
</li>
</ol>
<ol class="arabic">
<li><p class="first">There will now be a folder named _myworkcell_core_. Change into that folder and edit the _package.xml_ file. Edit the file and change the description, author, etc., as desired.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">myworkcell_core</span>
<span class="pre">gedit</span> <span class="pre">package.xml</span>
<span class="pre">`</span></code></p>
<p>_If you forget to add a dependency when creating a package, you can add additional dependencies in the _package.xml_ file._</p>
</li>
</ol>
<p>### STOP!  We’ll go through a few more lecture slides before continuing this exercise.</p>
<p>### Create a Node
1. In the package folder, edit the _CMakeLists.txt_ file using _gedit_. Browse through the example rules, and add an executable(_add_executable_), node named vision_node, source file named vision_node.cpp. Also within the _CMakeLists.txt_, make sure your new vision_node gets linked (‘target_link_libraries’) to the catkin libraries.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">`</span> <span class="pre">cmake</span>
<span class="pre">add_compile_options(-std=c++11)</span>
<span class="pre">add_executable(vision_node</span> <span class="pre">src/vision_node.cpp)</span>
<span class="pre">target_link_libraries(vision_node</span> <span class="pre">${catkin_LIBRARIES})</span>
<span class="pre">`</span></code></p>
<p>These lines can be placed anywhere in <cite>CMakeLists.txt</cite>, but I typically:</p>
<ul class="simple">
<li>Uncomment existing template examples for <cite>add_compile_options</cite> near the top (just below <cite>project()</cite>)</li>
<li>Uncomment and edit existing template examples for <cite>add_executable</cite> and <cite>target_link_libraries</cite> near the bottom</li>
<li>This helps make sure these rules are defined in the correct order, and makes it easy to remember the proper syntax.</li>
</ul>
<p>_Note: You’re also allowed to spread most of the CMakeLists rules across multiple lines, as shown in the <cite>target_link_libraries</cite> template <a href="#id21"><span class="problematic" id="id22">code_</span></a></p>
</div></blockquote>
<ol class="arabic simple">
<li>In the package folder, create the file _src/<a href="#id23"><span class="problematic" id="id24">vision_node.cpp_</span></a> (using _gedit_).</li>
</ol>
<ol class="arabic">
<li><p class="first">Add the ros header (include ros.h).</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span> <span class="pre">c++</span>
<span class="pre">/**</span>
<span class="pre">**</span>&#160; <span class="pre">Simple</span> <span class="pre">ROS</span> <span class="pre">Node</span>
<span class="pre">**/</span>
<span class="pre">#include</span> <span class="pre">&lt;ros/ros.h&gt;</span>
<span class="pre">`</span></code></p>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Add a main function (typical in c++ programs).</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>` c++
/**
**  Simple ROS Node
<a href="#id3"><span class="problematic" id="id4">**</span></a>/
#include &lt;ros/ros.h&gt;</p>
<p>int main(int argc, char* argv[])
{</p>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Initialize your ROS node (within the main).</p>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a>` c++
/**
**  Simple ROS Node
<a href="#id7"><span class="problematic" id="id8">**</span></a>/
#include &lt;ros/ros.h&gt;</p>
<p>int main(int argc, char* argv[])
{</p>
<blockquote>
<div><p>// This must be called before anything else ROS-related
ros::init(argc, argv, “vision_node”);</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Create a ROS node handle.</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a>` c++
/**
**  Simple ROS Node
<a href="#id11"><span class="problematic" id="id12">**</span></a>/
#include &lt;ros/ros.h&gt;</p>
<p>int main(int argc, char* argv[])
{</p>
<blockquote>
<div><p>// This must be called before anything else ROS-related
ros::init(argc, argv, “vision_node”);</p>
<p>// Create a ROS node handle
ros::NodeHandle nh;</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Print a “Hello World” message using ROS print tools.</p>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a>` c++
/**
**  Simple ROS Node
<a href="#id15"><span class="problematic" id="id16">**</span></a>/
#include &lt;ros/ros.h&gt;</p>
<p>int main(int argc, char* argv[])
{</p>
<blockquote>
<div><p>// This must be called before anything else ROS-related
ros::init(argc, argv, “vision_node”);</p>
<p>// Create a ROS node handle
ros::NodeHandle nh;</p>
<p>ROS_INFO(“Hello, World!”);</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Do not exit the program automatically - keep the node alive.</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a>` c++
/**
**  Simple ROS Node
<a href="#id19"><span class="problematic" id="id20">**</span></a>/
#include &lt;ros/ros.h&gt;</p>
<p>int main(int argc, char* argv[])
{</p>
<blockquote>
<div><p>// This must be called before anything else ROS-related
ros::init(argc, argv, “vision_node”);</p>
<p>// Create a ROS node handle
ros::NodeHandle nh;</p>
<p>ROS_INFO(“Hello, World!”);</p>
<p>// Don’t exit the program.
ros::spin();</p>
</div></blockquote>
<p>_ROS_INFO_ is one of the many [logging methods](<a class="reference external" href="http://wiki.ros.org/roscpp/Overview/Logging">http://wiki.ros.org/roscpp/Overview/Logging</a>).</p>
<ul class="simple">
<li>It will print the message to the terminal output, and send it to the _/<a href="#id25"><span class="problematic" id="id26">rosout_</span></a> topic for other nodes to monitor.</li>
<li>There are 5 levels of logging: _DEBUG, INFO, WARNING, ERROR, &amp; FATAL._</li>
<li>To use a different logging level, replace INFO in _ROS_INFO_ or _ROS_INFO_STREAM_ with the appropriate level.</li>
<li>Use _ROS_INFO_ for printf-style logging, and _ROS_INFO_STREAM_ for cout-style logging.</li>
</ul>
</li>
</ol>
<ol class="arabic simple">
<li>Build your program (node), by running <cite>catkin build</cite> in a terminal window<ul>
<li>_Remember that you must run <cite>catkin build</cite> from within your <cite>catkin_ws</cite> (or any subdirectory)_</li>
<li>This will build all of the programs, libraries, etc. in _myworkcell_core_</li>
<li>In this case, it’s just a single ROS node _vision_node_</li>
</ul>
</li>
</ol>
<p>### Run a Node</p>
<ol class="arabic">
<li><p class="first">Open a terminal and start the ROS master.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">roscore</span>
<span class="pre">`</span></code></p>
<p>_The ROS Master must be running before any ROS nodes can function._</p>
</li>
<li><p class="first">Open a second terminal to run your node.</p>
<ul>
<li><p class="first">In a previous exercise, we added a line to our <cite>.bashrc</cite> to automatically source <cite>devel/setup.bash</cite> in new terminal windows</p>
</li>
<li><p class="first">This will automatically export the results of the build into your new terminal session.</p>
</li>
<li><p class="first">If you’re reusing an existing terminal, you’ll need to manually source the setup files (since we added a new node):</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">source</span> <span class="pre">~/catkin_ws/devel/setup.bash</span>
<span class="pre">`</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Run your node.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">rosrun</span> <span class="pre">myworkcell_core</span> <span class="pre">vision_node</span>
<span class="pre">`</span></code></p>
<p>_This runs the program we just created. Remember to use TAB to help speed-up typing and reduce errors._</p>
</li>
<li><p class="first">In a third terminal, check what nodes are running.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">rosnode</span> <span class="pre">list</span>
<span class="pre">`</span></code></p>
<p>_In addition to the /rosout node, you should now see a new /vision_node listed._</p>
</li>
<li><p class="first">Enter _rosnode kill /<a href="#id27"><span class="problematic" id="id28">vision_node_</span></a>. This will stop the node.</p>
<p>_Note: It is more common to use Ctrl+C to stop a running node in the current terminal window._</p>
</li>
</ol>
<p>### Challenge</p>
<p>Goal: Modify the node so that it prints your name. This will require you to run through the build process again.</p>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, University of Tartu, License CC BY-ND-NC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>